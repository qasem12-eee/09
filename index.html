<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ø³ÙÙŠØ± | Ø§Ù„Ø¬ÙˆØ¯Ø© ÙÙŠ ÙƒÙ„ Ø·Ù„Ø¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a531b;
            --secondary-color: #2e7d32;
            --accent-color: #ffc107;
            --text-dark: #2d3436;
            --text-light: #636e72;
            --bg-light: #f9fbf9;
            --white: #ffffff;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-dark); scroll-behavior: smooth; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); box-shadow: 0 2px 20px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; padding: 10px 0; }
        .nav-wrapper { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; cursor: pointer; }
        .logo-icon { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .logo-text h1 { font-size: 22px; color: var(--primary-color); margin-bottom: 3px; }
        .logo-text span { font-size: 11px; color: var(--text-light); letter-spacing: 0.5px; }

        .hero-card { position: relative; height: 500px; border-radius: 30px; overflow: hidden; display: flex; align-items: center; background: #2d3436; margin-top: 20px; }
        .hero-img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .hero-overlay { position: relative; z-index: 2; padding: 0 60px; max-width: 700px; color: white; }
        .hero-overlay h2 { font-size: 42px; margin-bottom: 15px; line-height: 1.2; }
        .hero-overlay p { font-size: 18px; margin-bottom: 25px; opacity: 0.9; }

        .section-header { text-align: center; margin: 60px 0 40px; }
        .section-header h2 { font-size: 32px; color: var(--primary-color); position: relative; display: inline-block; padding-bottom: 15px; }
        .section-header h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 60px; height: 4px; background: var(--accent-color); border-radius: 2px; }

        .ramadan-offers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin: 20px 0 40px; }
        
        .card { background: var(--white); border-radius: 20px; padding: 15px; transition: var(--transition); border: 1px solid rgba(0,0,0,0.05); text-align: center; cursor: pointer; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card-img-wrapper { height: 160px; border-radius: 15px; overflow: hidden; margin-bottom: 12px; }
        .card-img-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .card:hover .card-img-wrapper img { transform: scale(1.05); }
        .card h4 { font-size: 15px; margin: 10px 0 5px; height: 40px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .card-price { color: var(--secondary-color); font-weight: 700; font-size: 17px; margin-top: 8px; }

        .order-section { background: #fff; border-radius: 30px; padding: 50px; margin: 60px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 50px; align-items: center; box-shadow: 0 10px 50px rgba(0,0,0,0.03); }
        .form-control { width: 100%; padding: 15px 20px; border: 2px solid #eee; border-radius: 12px; margin-bottom: 20px; font-size: 16px; transition: var(--transition); }
        .form-control:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px rgba(26, 83, 27, 0.1); }
        .btn-whatsapp { background: #25d366; color: white; width: 100%; padding: 18px; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: var(--transition); text-decoration: none; }
        .btn-whatsapp:hover { background: #1da851; transform: translateY(-2px); }
        
        .admin-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10000; justify-content:center; align-items:center; backdrop-filter: blur(8px); padding:20px; }
        .admin-content { background:white; padding:30px; border-radius:20px; width:100%; max-width:500px; max-height:90vh; overflow-y:auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        
        .password-protection { margin: 15px 0; }
        .password-input { direction: ltr; text-align: center; letter-spacing: 2px; }
        
        .offer-count { display: inline-block; background: var(--accent-color); color: #000; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-right: 10px; font-weight: bold; }
        
        .loading { display: flex; justify-content: center; padding: 40px; }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .delete-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap:10px; margin-top:15px; max-height: 300px; overflow-y: auto; padding: 10px; border: 1px solid #eee; border-radius: 10px; }
        .delete-item { position:relative; border:1px solid #ddd; border-radius:8px; overflow:hidden; background: white; }
        .delete-item img { width:100%; height:70px; object-fit:cover; }
        .delete-item-title { padding:5px; font-size:11px; text-align:center; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
        .delete-btn { position:absolute; top:2px; right:2px; background:red; color:white; border:none; border-radius:50%; width:22px; height:22px; cursor:pointer; font-size:12px; display:flex; align-items:center; justify-content:center; }
        
        .features-list { list-style: none; padding-right: 0; }
        .features-list li { margin-bottom: 8px; }
        .features-list i { color: var(--secondary-color); margin-left: 8px; }
        
        @media (max-width: 992px) { 
            .order-section { grid-template-columns: 1fr; padding: 30px; } 
            .hero-overlay { padding: 0 20px; }
            .hero-card { height: 400px; }
            .hero-overlay h2 { font-size: 32px; }
        }
        @media (max-width: 576px) {
            .hero-card { height: 300px; }
            .admin-content { padding: 20px; }
            .ramadan-offers-grid { grid-template-columns: repeat(2, 1fr); }
            .hero-overlay h2 { font-size: 24px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo" ondblclick="toggleAdmin()">
                    <div class="logo-icon"><i class="fas fa-leaf"></i></div>
                    <div class="logo-text">
                        <h1>Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ø³ÙÙŠØ±</h1>
                        <span>AL-SAFEER MARKET</span>
                    </div>
                </div>
                <a href="tel:0550358482" class="btn-whatsapp" style="padding: 10px 20px; font-size: 14px; background: var(--primary-color);">
                    <i class="fas fa-phone"></i> Ø§ØªØµÙ„ Ø¨Ù†Ø§
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <div class="hero-card">
                <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=1200&q=80" class="hero-img" alt="Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ø³ÙÙŠØ± - Ù…Ù†ØªØ¬Ø§Øª Ø·Ø§Ø²Ø¬Ø©">
                <div class="hero-overlay">
                    <h2>Ù…Ù‚Ø§Ø¶ÙŠ Ø§Ù„Ø¨ÙŠØª.. <br>ØªÙˆØµÙ„Ùƒ Ø·Ø§Ø²Ø¬Ø© ÙˆØ¨Ø³Ø±Ø¹Ø©!</h2>
                    <p>Ø£Ø¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Ù†Ø®ØªØ§Ø±Ù‡Ø§ Ù„Ùƒ Ø¨Ø¹Ù†Ø§ÙŠØ© ÙˆÙ†ÙˆØµÙ„Ù‡Ø§ Ù„Ø¨Ø§Ø¨ Ø¨ÙŠØªÙƒ.</p>
                    <a href="#orderForm" class="btn-whatsapp" style="width: 200px; background: var(--accent-color); color: #000;">
                        <i class="fas fa-shopping-cart"></i> Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†
                    </a>
                </div>
            </div>
        </section>

        <section class="section-header" id="ramadan-offers">
            <h2><span class="offer-count" id="offersCount">0</span> Ø¹Ø±ÙˆØ¶ Ø±Ù…Ø¶Ø§Ù† ğŸŒ™</h2>
        </section>
        
        <div class="ramadan-offers-grid" id="ramadanGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <section class="order-section" id="orderForm">
            <div>
                <h2 style="color:var(--primary-color); margin-bottom:15px;">Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ›’</h2>
                <p style="color: var(--text-light); line-height: 1.6;">Ø£Ø±Ø³Ù„ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ ÙˆØ³Ù†ØªÙƒÙÙ„ Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©.</p>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 12px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;"><i class="fas fa-bolt"></i> Ù…Ù…ÙŠØ²Ø§ØªÙ†Ø§:</h4>
                    <ul class="features-list">
                        <li><i class="fas fa-check-circle"></i> Ù…Ù†ØªØ¬Ø§Øª Ø·Ø§Ø²Ø¬Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</li>
                        <li><i class="fas fa-check-circle"></i> Ø£Ø³Ø¹Ø§Ø± ØªÙ†Ø§ÙØ³ÙŠØ©</li>
                        <li><i class="fas fa-check-circle"></i> Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</li>
                        <li><i class="fas fa-check-circle"></i> ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</li>
                    </ul>
                </div>
            </div>
            <form id="safeerOrderForm">
                <textarea id="msgDetails" class="form-control" rows="5" placeholder="Ø§ÙƒØªØ¨ Ø·Ù„Ø¨Ø§ØªÙƒ Ù‡Ù†Ø§ (Ù…Ø«Ù„Ø§Ù‹: 2 ÙƒØ±ØªÙˆÙ† Ù…Ø§Ø¡ØŒ 1 ÙƒÙŠÙ„Ùˆ Ø·Ù…Ø§Ø·Ù…ØŒ 3 Ø¹Ù„Ø¨ ØªÙˆÙ†Ø©...)" required></textarea>
                <input type="text" id="msgAddress" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ø§Ù„ØªÙØµÙŠÙ„">
                <input type="text" id="msgPhone" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <button type="submit" class="btn-whatsapp">
                    <i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…ØªØ¬Ø±
                </button>
                <p style="text-align: center; margin-top: 15px; color: var(--text-light); font-size: 14px;">
                    Ø³ÙŠØªÙ… ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©
                </p>
            </form>
        </section>
    </main>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <div id="adminPanel" class="admin-modal">
        <div class="admin-content">
            <h2 style="text-align:center; color:var(--primary-color); margin-bottom: 10px;">
                <i class="fas fa-cogs"></i> Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙÙŠØ±
            </h2>
            <p style="text-align:center; color: var(--text-light); margin-bottom: 20px; font-size: 14px;">
                Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø±ÙˆØ¶ Ø±Ù…Ø¶Ø§Ù† ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            </p>
            <hr style="margin:15px 0; border-color: #eee;">
            
            <!-- Ø­Ù…Ø§ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¨Ø³ÙŠØ·Ø© -->
            <div id="passwordSection" class="password-protection">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="adminPassword" class="form-control password-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button onclick="checkPassword()" class="btn-whatsapp" style="background: var(--primary-color); margin-top: 10px;">
                    <i class="fas fa-lock"></i> ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
            </div>
            
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ¹Ù„ÙŠØ© (Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) -->
            <div id="adminControls" style="display: none;">
                <label>Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±Ø¶:</label>
                <input type="file" id="imageFile" accept="image/*" class="form-control" style="padding: 10px;">
                
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
                <input type="text" id="dbTitle" placeholder="Ù…Ø«Ø§Ù„: ÙÙŠÙ…ØªÙˆ 710 Ù…Ù„" class="form-control">
                
                <label>Ø§Ù„Ø³Ø¹Ø±:</label>
                <input type="text" id="dbPrice" placeholder="Ù…Ø«Ø§Ù„: 15 Ø±ÙŠØ§Ù„" class="form-control">

                <div id="uploadStatus" style="text-align:center; margin:15px 0; padding: 10px; border-radius: 8px;"></div>
                
                <button id="uploadBtn" onclick="handleAdminUpload()" class="btn-whatsapp" style="background:var(--secondary-color);">
                    <i class="fas fa-cloud-upload-alt"></i> Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†
                </button>
                
                <hr style="margin:20px 0;">
                
                <h3 style="text-align:center; color: var(--primary-color);">
                    <i class="fas fa-trash-alt"></i> Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø°Ù Ø§Ù„Ø¹Ø±ÙˆØ¶
                </h3>
                <div id="deleteManager" class="delete-grid"></div>
                
                <button onclick="toggleAdmin()" style="width:100%; margin-top:20px; border:none; padding:12px; border-radius:10px; cursor:pointer; background: #f1f1f1; color: #333;">
                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
            </div>
        </div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ===================== Ø¥Ø¹Ø¯Ø§Ø¯ Supabase =====================
        const SUPABASE_URL = 'https://itmlofbytmvcthfrcbep.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml0bWxvZmJ5dG12Y3RoZnJjYmVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ2MzA2MTYsImV4cCI6MjAzMDIwNjYxNn0.Q_BqRq8k9hI5NOvzNqaKYVhl9xSOS4TQG6n6An8U4mI';
        
        // ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§)
        const ADMIN_PASSWORD = 'admin123';
        
        // ØªÙ‡ÙŠØ¦Ø© Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let isAdminAuthenticated = false;
        
        // ===================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© =====================
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                document.getElementById('passwordSection').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
                loadItemsForDelete();
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }
        
        // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function toggleAdmin() {
            const panel = document.getElementById('adminPanel');
            const isVisible = panel.style.display === 'flex';
            
            if (!isVisible) {
                panel.style.display = 'flex';
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                isAdminAuthenticated = false;
                document.getElementById('passwordSection').style.display = 'block';
                document.getElementById('adminControls').style.display = 'none';
                document.getElementById('adminPassword').value = '';
            } else {
                panel.style.display = 'none';
            }
        }
        
        // Ø±ÙØ¹ Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯
        async function handleAdminUpload() {
            const file = document.getElementById('imageFile').files[0];
            const title = document.getElementById('dbTitle').value.trim();
            const price = document.getElementById('dbPrice').value.trim();
            const btn = document.getElementById('uploadBtn');
            const status = document.getElementById('uploadStatus');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
            if (!file) {
                status.innerHTML = '<span style="color: red;">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</span>';
                return;
            }
            
            if (!title) {
                status.innerHTML = '<span style="color: red;">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</span>';
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            if (!file.type.startsWith('image/')) {
                status.innerHTML = '<span style="color: red;">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© (Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØ± ÙÙ‚Ø·)</span>';
                return;
            }
            
            btn.disabled = true;
            status.innerHTML = '<div style="color: blue;">â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';
            
            try {
                // 1. Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ®Ø²ÙŠÙ†
                const fileName = `${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
                const filePath = `ramadan-offers/${fileName}`;
                
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('market')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                    
                if (uploadError) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©:', uploadError);
                    throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ${uploadError.message}`);
                }
                
                // 2. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
                const { data: urlData } = supabase.storage
                    .from('market')
                    .getPublicUrl(filePath);
                
                // 3. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const { data: dbData, error: dbError } = await supabase
                    .from('ramadan_offers')
                    .insert([
                        {
                            image_url: urlData.publicUrl,
                            title: title,
                            price: price || 'Ø³Ø§Ø±Ø¹ Ø¨Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡',
                            storage_path: filePath,
                            created_at: new Date().toISOString()
                        }
                    ]);
                    
                if (dbError) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', dbError);
                    throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${dbError.message}`);
                }
                
                // 4. Ø§Ù„Ù†Ø¬Ø§Ø­ - Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
                status.innerHTML = '<span style="color: green;">âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­!</span>';
                document.getElementById('dbTitle').value = '';
                document.getElementById('dbPrice').value = '';
                document.getElementById('imageFile').value = '';
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶
                await loadOffers();
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù
                await loadItemsForDelete();
                
                // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    status.innerHTML = '';
                }, 2000);
                
            } catch (error) {
                console.error('Error uploading:', error);
                status.innerHTML = `<span style="color: red;">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}</span>`;
            } finally {
                btn.disabled = false;
            }
        }
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ¹Ø±Ø¶Ù‡Ø§
        async function loadOffers() {
            const grid = document.getElementById('ramadanGrid');
            const countElement = document.getElementById('offersCount');
            
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const { data: offers, error } = await supabase
                    .from('ramadan_offers')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶:', error);
                    throw error;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯
                countElement.textContent = offers.length;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶
                if (offers.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                            <i class="fas fa-box-open" style="font-size: 48px; color: #ddd; margin-bottom: 15px;"></i>
                            <p style="color: var(--text-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            <p style="color: var(--text-light); font-size: 14px;">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¹Ø±ÙˆØ¶ Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
                        </div>`;
                    return;
                }
                
                grid.innerHTML = '';
                offers.forEach(offer => {
                    grid.innerHTML += `
                        <div class="card">
                            <div class="card-img-wrapper">
                                <img src="${offer.image_url}" alt="${offer.title}" loading="lazy">
                            </div>
                            <h4>${offer.title}</h4>
                            <div class="card-price">${offer.price}</div>
                        </div>`;
                });
                
            } catch (error) {
                console.error('Error loading offers:', error);
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-triangle" style="color: #ff6b6b; font-size: 48px; margin-bottom: 15px;"></i>
                        <p style="color: var(--text-light);">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶</p>
                        <p style="color: var(--text-light); font-size: 14px;">ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©</p>
                    </div>`;
            }
        }
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø­Ø°Ù
        async function loadItemsForDelete() {
            const manager = document.getElementById('deleteManager');
            
            if (!isAdminAuthenticated) return;
            
            manager.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px;"><div class="loading-spinner"></div></div>';
            
            try {
                const { data: offers, error } = await supabase
                    .from('ramadan_offers')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ù„Ù„Ø­Ø°Ù:', error);
                    throw error;
                }
                
                if (offers.length === 0) {
                    manager.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color: var(--text-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù„Ù„Ø­Ø°Ù</div>';
                    return;
                }
                
                manager.innerHTML = '';
                offers.forEach(offer => {
                    manager.innerHTML += `
                        <div class="delete-item">
                            <img src="${offer.image_url}" alt="${offer.title}">
                            <div class="delete-item-title">${offer.title.substring(0, 15)}${offer.title.length > 15 ? '...' : ''}</div>
                            <button onclick="deleteOffer('${offer.id}', '${offer.storage_path}')" class="delete-btn">âœ•</button>
                        </div>`;
                });
                
            } catch (error) {
                console.error('Error loading items for delete:', error);
                manager.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
            }
        }
        
        // Ø­Ø°Ù Ø¹Ø±Ø¶
        async function deleteOffer(id, storagePath) {
            if (!isAdminAuthenticated) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                return;
            }
            
            try {
                // 1. Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³Ø§Ø± ØªØ®Ø²ÙŠÙ†)
                if (storagePath) {
                    const { error: storageError } = await supabase.storage
                        .from('market')
                        .remove([storagePath]);
                    
                    if (storageError) {
                        console.warn('Could not delete image from storage:', storageError);
                        // Ù†Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©
                    }
                }
                
                // 2. Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const { error: dbError } = await supabase
                    .from('ramadan_offers')
                    .delete()
                    .eq('id', id);
                
                if (dbError) throw dbError;
                
                // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­');
                await loadItemsForDelete();
                await loadOffers(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ù… Ø£ÙŠØ¶Ø§Ù‹
                
            } catch (error) {
                console.error('Error deleting offer:', error);
                alert(`Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ${error.message}`);
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        document.getElementById('safeerOrderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const details = document.getElementById('msgDetails').value.trim();
            const address = document.getElementById('msgAddress').value.trim();
            const phone = document.getElementById('msgPhone').value.trim();
            
            if (!details) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø·Ù„Ø¨Ø§ØªÙƒ');
                document.getElementById('msgDetails').focus();
                return;
            }
            
            let message = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙÙŠØ±*\n\n`;
            message += `*Ø§Ù„Ø·Ù„Ø¨Ø§Øª:*\n${details}\n\n`;
            
            if (address) {
                message += `*Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:*\n${address}\n\n`;
            }
            
            if (phone) {
                message += `*Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:*\n${phone}\n\n`;
            }
            
            const now = new Date();
            message += `*Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${now.toLocaleDateString('ar-SA')}\n`;
            message += `*Ø§Ù„ÙˆÙ‚Øª:* ${now.toLocaleTimeString('ar-SA', {hour: '2-digit', minute:'2-digit'})}`;
            
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/966550358482?text=${encodedMessage}`, '_blank');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            this.reset();
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ©
        function startAutoRefresh() {
            loadOffers();
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ©
            setInterval(loadOffers, 60000);
        }
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±
        function setupScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„Ù‡Ø§
            setTimeout(() => {
                document.querySelectorAll('.card').forEach(card => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    observer.observe(card);
                });
            }, 100);
        }
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadOffers();
            startAutoRefresh();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            setTimeout(setupScrollAnimations, 500);
            
            // ØªØ­Ø¯ÙŠØ« ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¹Ø±ÙˆØ¶ Ø¬Ø¯ÙŠØ¯Ø©
            const originalLoadOffers = loadOffers;
            loadOffers = async function() {
                await originalLoadOffers();
                setupScrollAnimations();
            };
        });
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('adminPanel').style.display = 'none';
            }
        });
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.getElementById('adminPanel').addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });
    </script>
</body>
</html>